<% layout('layout') %>

<section class="py-5">
    <div class="container">
        <div class="row">
            <!-- Product Images -->
            <div class="col-lg-6 mb-4">
                <div class="product-images">
                    <div class="main-image mb-3">
                        <img id="mainImage" src="<%= product.images[0] %>" class="img-fluid rounded shadow" alt="<%= product.name %>">
                    </div>
                    <% if (product.images.length > 1) { %>
                        <div class="thumbnail-images">
                            <div class="row">
                                <% product.images.forEach((image, index) => { %>
                                    <div class="col-3">
                                        <img src="<%= image %>" class="img-fluid rounded thumbnail-img cursor-pointer <%= index === 0 ? 'active' : '' %>" 
                                             alt="<%= product.name %> - Image <%= index + 1 %>"
                                             onclick="changeMainImage('<%= image %>', this)">
                                    </div>
                                <% }) %>
                            </div>
                        </div>
                    <% } %>
                </div>
            </div>

            <!-- Product Details -->
            <div class="col-lg-6">
                <div class="product-details">
                    <nav aria-label="breadcrumb" class="mb-3">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/">Home</a></li>
                            <li class="breadcrumb-item"><a href="/products">Family Products</a></li>
                            <li class="breadcrumb-item active" aria-current="page"><%= product.name %></li>
                        </ol>
                    </nav>

                    <h1 class="display-6 fw-bold mb-3"><%= product.name %></h1>
                    <p class="text-muted mb-3">SKU: <%= product.sku %> | Category: <%= product.category %></p>
                    
                    <div class="price-section mb-4">
                        <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <h2 class="text-primary mb-0 fw-bold">₹<%= product.price %></h2>
                                <small class="text-success">
                                    <i class="fas fa-truck me-1"></i>FREE Delivery • 
                                    <i class="fas fa-undo me-1"></i>7-Day Returns
                                </small>
                            </div>
                            <div class="text-end">
                                <div class="stars mb-1">
                                    <i class="fas fa-star text-warning"></i>
                                    <i class="fas fa-star text-warning"></i>
                                    <i class="fas fa-star text-warning"></i>
                                    <i class="fas fa-star text-warning"></i>
                                    <i class="fas fa-star text-warning"></i>
                                </div>
                                <small class="text-muted">4.9 (3,247 happy families)</small>
                            </div>
                        </div>
                        <p class="text-muted">
                            <i class="fas fa-shield-check text-success me-1"></i>
                            <strong>100% SAFE:</strong> Pay only when your family is happy!
                        </p>
                    </div>

                    <!-- Urgency & Scarcity -->
                    <div class="stock-info mb-4">
                        <% if (product.stock > 5) { %>
                            <div class="alert alert-success py-2">
                                <i class="fas fa-check-circle me-2"></i>
                                <strong>Great News!</strong> This family favorite is in stock and ready to bring joy
                            </div>
                        <% } else if (product.stock > 0) { %>
                            <div class="alert alert-warning py-2">
                                <i class="fas fa-fire me-2"></i>
                                <strong>URGENT!</strong> Only <%= product.stock %> left - Don't let your family miss out!
                            </div>
                        <% } else { %>
                            <div class="alert alert-danger py-2">
                                <i class="fas fa-times-circle me-2"></i>
                                <strong>Sorry!</strong> This item is currently out of stock
                            </div>
                        <% } %>
                    </div>

                    <!-- Pain Relief Section -->
                    <div class="pain-relief-section mb-4">
                        <div class="bg-light p-3 rounded">
                            <h6 class="fw-bold text-primary mb-2">
                                <i class="fas fa-heart me-2"></i>How This Transforms Your Family's Life
                            </h6>
                            <ul class="list-unstyled mb-0">
                                <li class="mb-1">
                                    <i class="fas fa-check text-success me-2"></i>
                                    <strong>No more worrying about safety</strong> - 100% tested and approved
                                </li>
                                <li class="mb-1">
                                <i class="fas fa-gift me-2"></i>FAMILY LOVE BONUS
                                    <strong>No more guilt about quality</strong> - Premium ingredients your family deserves
                                </li>
                                <li class="mb-0">
                                <li><i class="fas fa-plus text-warning me-2"></i>FREE safety guide for your family</li>
                                <li><i class="fas fa-plus text-warning me-2"></i>FREE care expert consultation</li>
                                <li><i class="fas fa-plus text-warning me-2"></i>Priority family support</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Social Proof -->
                    <div class="social-proof-section mb-4">
                        <div class="d-flex align-items-center mb-2">
                            <div class="customer-faces me-3">
                                <img src="https://images.pexels.com/photos/1239291/pexels-photo-1239291.jpeg?auto=compress&cs=tinysrgb&w=30&h=30&fit=crop" class="rounded-circle customer-face-small" alt="Customer">
                                <img src="https://images.pexels.com/photos/774909/pexels-photo-774909.jpeg?auto=compress&cs=tinysrgb&w=30&h=30&fit=crop" class="rounded-circle customer-face-small" alt="Customer">
                                <img src="https://images.pexels.com/photos/1222271/pexels-photo-1222271.jpeg?auto=compress&cs=tinysrgb&w=30&h=30&fit=crop" class="rounded-circle customer-face-small" alt="Customer">
                            </div>
                            <small class="text-muted">
                                <strong>3,247 families</strong> chose this for their loved ones in the last 30 days
                            </small>
                        </div>
                        <div class="recent-purchase bg-success bg-opacity-10 p-2 rounded">
                            <small class="text-success">
                                <i class="fas fa-shopping-bag me-1"></i>
                                <strong>Priya from Mumbai</strong> just ordered this for her baby 3 minutes ago
                            </small>
                        </div>
                    </div>

                    <!-- Guarantee Box -->
                    <div class="guarantee-section mb-4">
                        <div class="border border-success rounded p-3 bg-success bg-opacity-5">
                            <h6 class="text-success fw-bold mb-2">
                                <i class="fas fa-certificate me-2"></i>OUR LOVE PROMISE TO YOUR FAMILY
                            </h6>
                            <div class="row">
                                <div class="col-6">
                                    <small class="d-block mb-1">
                                        <i class="fas fa-check text-success me-1"></i>100% Happiness Guarantee
                                    </small>
                                    <small class="d-block">
                                        <i class="fas fa-check text-success me-1"></i>Free Replacement
                                    </small>
                                </div>
                                <div class="col-6">
                                    <small class="d-block mb-1">
                                        <i class="fas fa-check text-success me-1"></i>Safety Guarantee
                                    </small>
                                    <small class="d-block">
                                        <i class="fas fa-check text-success me-1"></i>Family Care Service
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bonus Section -->
                    <% if (product.stock > 0) { %>
                        <div class="bonus-section mb-4">
                            <div class="bg-warning bg-opacity-10 border border-warning rounded p-3">
                                <h6 class="text-warning fw-bold mb-2">
                                    <i class="fas fa-gift me-2"></i>LIMITED TIME BONUS
                                </h6>
                                <p class="mb-2 small">Order now and get:</p>
                                <ul class="list-unstyled mb-0 small">
                                    <li><i class="fas fa-plus text-warning me-2"></i>FREE premium packaging</li>
                                    <li><i class="fas fa-plus text-warning me-2"></i>FREE care instructions card</li>
                                    <li><i class="fas fa-plus text-warning me-2"></i>Priority customer support</li>
                                </ul>
                            </div>
                        </div>
                    <% } %>

                    <div class="stock-info mb-4 d-none">
                        <% if (product.stock > 5) { %>
                            <span class="badge bg-success fs-6">
                                <i class="fas fa-check me-1"></i>In Stock (<%= product.stock %> available)
                            </span>
                        <% } else if (product.stock > 0) { %>
                            <span class="badge bg-warning fs-6">
                                <i class="fas fa-exclamation-triangle me-1"></i>Only <%= product.stock %> left in stock
                            </span>
                        <% } else { %>
                            <span class="badge bg-danger fs-6">
                                <i class="fas fa-times me-1"></i>Out of Stock
                            </span>
                        <% } %>
                    </div>

                    <div class="product-description mb-4">
                        <h5 class="fw-bold">How This Transforms Your Family</h5>
                        <p><%= product.description %></p>
                    </div>

                    <!-- Add to Cart Form -->
                    <% if (product.stock > 0) { %>
                        <form id="addToCartForm">
                            <input type="hidden" name="productId" value="<%= product._id %>">
                            
                            <!-- Size Selection -->
                            <% if (product.sizes && product.sizes.length > 0) { %>
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Size *</label>
                                    <div class="size-options">
                                        <% product.sizes.forEach(size => { %>
                                            <input type="radio" class="btn-check" name="size" id="size_<%= size %>" value="<%= size %>" required>
                                            <label class="btn btn-outline-primary me-2 mb-2" for="size_<%= size %>"><%= size %></label>
                                        <% }) %>
                                    </div>
                                </div>
                            <% } %>

                            <!-- Color Selection -->
                            <% if (product.colors && product.colors.length > 0) { %>
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Color *</label>
                                    <div class="color-options">
                                        <% product.colors.forEach(color => { %>
                                            <input type="radio" class="btn-check" name="color" id="color_<%= color %>" value="<%= color %>" required>
                                            <label class="btn btn-outline-secondary me-2 mb-2" for="color_<%= color %>"><%= color %></label>
                                        <% }) %>
                                    </div>
                                </div>
                            <% } %>

                            <!-- Quantity -->
                            <div class="mb-4">
                                <label class="form-label fw-bold">Quantity</label>
                                <div class="quantity-input d-flex align-items-center">
                                    <button type="button" class="btn btn-outline-secondary" onclick="changeQuantity(-1)">-</button>
                                    <input type="number" name="quantity" id="quantity" class="form-control mx-2" value="1" min="1" max="<%= product.stock %>" style="width: 80px;">
                                    <button type="button" class="btn btn-outline-secondary" onclick="changeQuantity(1)">+</button>
                                </div>
                            </div>

                            <!-- Add to Cart Button -->
                            <div class="cart-actions">
                                <!-- Buy Now Button (Primary CTA) -->
                                <a href="/products/<%= product._id %>/buy-now" class="btn btn-warning btn-lg w-100 mb-3 fw-bold pulse-animation">
                                    <i class="fas fa-bolt me-2"></i>GET THIS FOR MY FAMILY NOW
                                </a>
                                
                                <!-- Add to Cart Button (Secondary) -->
                                <button type="submit" class="btn btn-outline-primary btn-lg w-100 mb-3">
                                    <i class="fas fa-shopping-cart me-2"></i>Add to Cart
                                </button>
                                
                                <a href="/products" class="btn btn-link text-center w-100 text-muted">
                                    <i class="fas fa-arrow-left me-2"></i>See More Family Products
                                </a>
                            </div>
                        </form>
                    <% } else { %>
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            This family favorite is currently out of stock. We're restocking for families like yours!
                        </div>
                        <a href="/products" class="btn btn-outline-primary btn-lg">
                            <i class="fas fa-arrow-left me-2"></i>See Other Family Products
                        </a>
                    <% } %>

                    <!-- FAQ Section -->
                    <div class="faq-section mt-5">
                        <h5 class="fw-bold mb-3">Questions from Caring Parents Like You</h5>
                        <div class="accordion" id="productFAQ">
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                                        Is this really safe for my baby/pet?
                                    </button>
                                </h2>
                                <div id="faq1" class="accordion-collapse collapse" data-bs-parent="#productFAQ">
                                    <div class="accordion-body">
                                        <strong>Absolutely!</strong> Every product is tested by pediatricians and veterinarians. We've served 75,000+ families safely. If your family isn't 100% happy, return it immediately - no questions asked.
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                                        What if my family doesn't love it?
                                    </button>
                                </h2>
                                <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#productFAQ">
                                    <div class="accordion-body">
                                        <strong>No worries!</strong> We offer 30-day love guarantee. If your baby or pet isn't happier, we'll replace it or refund completely - your family's happiness is our priority.
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                                        How do I know this will actually work?
                                    </button>
                                </h2>
                                <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#productFAQ">
                                    <div class="accordion-body">
                                        Our 4.9/5 rating from 75,000+ families speaks for itself. Plus, you pay ONLY after seeing your family's happiness. Zero risk, maximum love guaranteed.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Trust Section -->
<section class="py-5 bg-gradient-light">
    <div class="container">
        <div class="text-center mb-4">
            <h4 class="fw-bold">Why 75,000+ Families Choose PAWS Over Others?</h4>
        </div>
        <div class="row text-center">
            <div class="col-md-3 mb-3">
                <div class="trust-feature hover-lift">
                    <i class="fas fa-shield-alt text-success fs-1 mb-2"></i>
                    <h6 class="fw-bold">100% Safe Products</h6>
                    <small class="text-muted">Tested and approved for your family</small>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="trust-feature hover-lift">
                    <i class="fas fa-money-bill-wave text-primary fs-1 mb-2"></i>
                    <h6 class="fw-bold">Zero Risk Shopping</h6>
                    <small class="text-muted">Pay only when your family is happy</small>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="trust-feature hover-lift">
                    <i class="fas fa-heart text-danger fs-1 mb-2"></i>
                    <h6 class="fw-bold">Love Guarantee</h6>
                    <small class="text-muted">30-day happiness promise</small>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="trust-feature hover-lift">
                    <i class="fas fa-phone-alt text-info fs-1 mb-2"></i>
                    <h6 class="fw-bold">Family Care Service</h6>
                    <small class="text-muted">We call before every delivery</small>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
// Change main product image
function changeMainImage(imageSrc, thumbnail) {
    document.getElementById('mainImage').src = imageSrc;
    
    // Update active thumbnail
    document.querySelectorAll('.thumbnail-img').forEach(img => img.classList.remove('active'));
    thumbnail.classList.add('active');
}

// Change quantity
function changeQuantity(change) {
    const quantityInput = document.getElementById('quantity');
    const currentValue = parseInt(quantityInput.value);
    const maxValue = parseInt(quantityInput.max);
    const minValue = parseInt(quantityInput.min);
    
    const newValue = currentValue + change;
    
    if (newValue >= minValue && newValue <= maxValue) {
        quantityInput.value = newValue;
    }
}

// Add to cart form submission
document.getElementById('addToCartForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const data = Object.fromEntries(formData);
    
    try {
        const response = await fetch('/cart/add', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
            // Update cart count in navbar
            const cartCountElement = document.querySelector('.badge');
            if (cartCountElement) {
                cartCountElement.textContent = result.cartCount;
            } else if (result.cartCount > 0) {
                // Create cart count badge if it doesn't exist
                const cartLink = document.querySelector('a[href="/cart"]');
                if (cartLink) {
                    cartLink.innerHTML += `<span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">${result.cartCount}</span>`;
                }
            }
            
            // Show success message
            
        } else {
            
        }
    } catch (error) {
        console.error('Error:', error);
    }
});
</script>